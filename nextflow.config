import java.time.*
Date now = new Date()

process {
    errorStrategy = 'finish'
    withName: trim {
        container = 'docker://staphb/trimmomatic:0.39'
    }
    withName: kraken {
        container = 'docker://staphb/kraken2:2.1.2-no-db'
    }
    withName: filterreads {
        conda = 'bioconda::krakentools=1.2'
    }
    withName: kraken2krona {
        conda = 'bioconda::krakentools=1.2'
    }
    withName: krona {
        conda = 'bioconda::krona=2.8'
    }
    withName: ray {
        container = 'library://millironx/default/ray:v2.3.1'
        errorStrategy = 'ignore'
    }
    withName: iva {
        container = 'docker://sangerpathogens/iva:1.0.11'
        errorStrategy = 'ignore'
    }
    withName: metavelvet {
        container = 'https://depot.galaxyproject.org/singularity/metavelvet:1.2.02--pl5.22.0_2'
    }
    withName: abyss {
        container = 'docker://bcgsc/abyss'
    }
    withName: bwa {
        container = 'docker://staphb/bwa:0.7.17'
    }
    withName: sortsam {
        container = 'docker://staphb/samtools:1.12'
    }
    withName: blast {
        container = 'docker://ncbi/blast:2.11.0'
    }
}
singularity {
    enabled = true
}
params {
    tracedir = '.trace'
    timestamp = now.format('yyyyMMdd-HH-mm-ss')
    trimmomatic {
        fastaWithAdapters = 'NexteraPE-PE.fa'
        seedMismatches = 2
        palindromeClipThreshold = 30
        simpleClipThreshold = 10
        windowSize = 0
        requiredQuality = 0
        leading = 0
        trailing = 0
        crop = 0
        headcrop = 0
        minlen = 0
    }
    seqpurge {
        a1 = 'AGATCGGAAGAGCACACGTCTGAACTCCAGTCA'
        a2 = 'AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGT'
        match_perc = 80
        mep = 1e-6
        qcut = 15
        qwin = 5
        qoff = 33
        ncut = 7
        min_len = 30
    }
    ray {
        kmerlength = 21
        minimumSeedLength = 100
        minimumContigLength = 100
        maximumSeedCoverageDepth = 4294967295
        minimumSeedCoverageDepth = 0
    }
    iva {
        k = 19
        s = 11
        y = 0.5
        ctg_first_trim = 25
        ctg_iter_trim = 10
        ext_min_cov = 10
        ext_min_ratio = 4
        ext_max_bases = 100
        ext_min_clip = 3
        max_contigs = 50
        seed_min_kmer_cov = 25
        seed_max_kmer_cov = 1000000
        seed_ext_max_bases = 50
        seed_ext_min_cov = 10
        seed_ext_min_ratio = 4
        max_insert = 800
    }
    bwa {
        n = 0.04
        o = 1
        e = -1
        d = 16
        i = 5
        k = 2
        M = 3
        O = 4
        E = 4
    }
    blast {
        max_hsps       = 10
        num_alignments = 5
        outfmt         = '"6 qseqid stitle sgi staxid ssciname scomname score bitscore qcovs evalue pident length slen saccver mismatch gapopen qstart qend sstart send"'
        evalue         = 1e-5
    }
}
timeline {
    enabled = true
    file = "${params.tracedir}/${params.timestamp}_timeline.html"
}
report {
    enabled = true
    file = "${params.tracedir}/${params.timestamp}_report.html"
}
trace {
    enabled = true
    file = "${params.tracedir}/${params.timestamp}_trace.txt"
}
dag {
    enabled = true
    file = "${params.tracedir}/${params.timestamp}_dag.svg"
}
